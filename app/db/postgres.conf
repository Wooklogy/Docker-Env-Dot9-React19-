# -----------------------------
# Connection & Security
# -----------------------------
listen_addresses = '*'
port = 5432
max_connections = 100         # 50은 동시 접속 시 금방 찰 수 있어 100으로 상향
password_encryption = scram-sha-256
ssl = off

# -----------------------------
# Resource Usage (성능의 핵심)
# -----------------------------
# Docker .env의 MEM_POSTGRES=2G 기준 최적값입니다.
shared_buffers = 512MB        # 전체 메모리의 25%
work_mem = 8MB                # 복잡한 정렬/조인 쿼리 대비 상향 (너무 낮으면 디스크 사용)
maintenance_work_mem = 128MB  # 인덱스 생성 및 관리용
effective_cache_size = 1536MB # OS 캐시 포함 전체 가용량의 75%

# -----------------------------
# Logging (형님의 '성능 추적' 최적화)
# -----------------------------
log_destination = 'stderr'
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_statement = 'ddl'         # 구조 변경만 기록
log_min_duration_statement = 200 # 200ms 이상 걸리는 '느린 쿼리'만 기록
log_checkpoints = on
log_lock_waits = on           # 데드락 및 잠금 대기 추적용
log_temp_files = 0            # 임시 파일 생성 시 기록 (work_mem 부족 판단 근거)

# -----------------------------
# Write-Ahead Log (안정성)
# -----------------------------
wal_level = replica
synchronous_commit = on       # 체결 데이터의 물리적 저장 보장